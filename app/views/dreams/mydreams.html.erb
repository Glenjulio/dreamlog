<!-- app/views/dreams/mydreams.html.erb -->
<h1>My dreams</h1>

<div class="mb-3">
  <%= link_to "New dream", new_dream_path, class: "btn btn-primary me-2" %>
  <%= link_to "All dreams", dreams_path, class: "btn btn-outline-secondary" %>
</div>

<% @dreams.each do |dream| %>
  <div class="card mb-2">
    <div class="card-body">
      <h5 class="card-title"><%= dream.title %></h5>
      <p class="card-text"><strong>Visibilit√© :</strong> <%= dream.private ? "Private" : "Public" %></p>

      <% if dream.audio.attached? %>
        <audio controls>
          <source src="<%= url_for(dream.audio) %>" type="<%= dream.audio.content_type %>">
          Your browser does not support the audio element.
        </audio>
      <% else %>
        <p><em>No recording available.</em></p>
      <% end %>

      <div class="mt-3">
        <%= link_to "See", dream_path(dream), class: "btn btn-sm btn-outline-light me-2" %>
        <%= link_to "Modify", edit_dream_path(dream), class: "btn btn-sm btn-outline-warning me-2" %>

        <!-- Bouton Transcription conditionnel -->
        <% if dream.audio.attached? %>
          <% if dream.transcription.present? %>
            <%= link_to "View Transcription", dream_transcription_path(dream), class: "btn btn-sm btn-outline-info me-2" %>
          <% else %>
            <%= link_to "Transcribe", transcribe_dream_path(dream), method: :post,
                data: {
                  confirm: "This will use OpenAI to transcribe your audio. Continue?",
                  turbo_method: :post
                },
                class: "btn btn-sm btn-outline-primary me-2" %>
          <% end %>
        <% end %>

        <%= link_to "Delete", dream_path(dream), method: :delete,
            data: {
              confirm: "Are you sure you want to delete this dream?",
              turbo_method: :delete
            },
            class: "btn btn-sm btn-outline-danger" %>
      </div>
    </div>
  </div>
<% end %>

<!-- Navbar -->
<%= render "shared/bottom_nav" %>
