<style>
  #analysisTabs .nav-link {
    background-color: rgba(63, 158, 244, 0.2) !important;
    color: white !important;
  }

    #analysisTabs .nav-link.active {
    background-color: rgba(63, 158, 244, 1) !important;
    color: white !important;
  }

  #analysisTabContent {
    min-height: 200px;
  }

</style>


<% if @analysis.present? %>
  <div class="container py-4 text-white">

    <!-- Title -->
    <h1 class="text-center mb-1">Analysis for </h1>
    <h1 class="text-center mb-5"><%= @dream.title %></h1>

    <!-- Tabs -->
    <% if @analysis.data.present? %>
      <h2 class="mb-3">Analysis</h2>

      <ul class="nav nav-tabs mb-3" id="analysisTabs" role="tablist">
        <% { "symbols" => "🎭 Symbols", "emotions" => "❤️ Emotions", "interpretation" => "🔍 Interpretation", "suggestions" => "🌟 Suggestions" }.each_with_index do |(key, label), index| %>
          <li class="nav-item" role="presentation">
            <button class="nav-link <%= 'active' if index == 0 %>" id="<%= key %>-tab" data-bs-toggle="tab" data-bs-target="#<%= key %>" type="button" role="tab">
              <%= label %>
            </button>
          </li>
        <% end %>
      </ul>

      <div class="tab-content border rounded-bottom p-3 bg-dark" id="analysisTabContent">
        <% { "symbols" => "🎭 Symbols", "emotions" => "❤️ Emotions", "interpretation" => "🔍 Interpretation", "suggestions" => "🌟 Suggestions" }.each_with_index do |(key, label), index| %>
          <div class="tab-pane fade <%= 'show active' if index == 0 %>" id="<%= key %>" role="tabpanel">
            <p><%= @analysis.data[key] %></p>
          </div>
        <% end %>
      </div>
    <% else %>
      <p><%= @analysis.content %></p>
    <% end %>

    <!-- Transcription -->
    <% if @transcription.content.present? %>
      <div class="my-4">
        <h3>Transcription</h3>
        <p><%= @transcription.content %></p>
      </div>
    <% end %>


    <!-- Additional Information -->
    <% if @transcription.dream_type.present? || @transcription.mood.present? || @transcription.tag.present? || @transcription.rating.present? %>
      <div class="mt-5">
        <h3>Additional Information</h3>
        <ul class="list-unstyled">
          <% if @transcription.dream_type.present? %>
            <li><strong>Type of dream:</strong> <%= @transcription.dream_type == "dream" ? "🌙 Dream" : "😱 Nightmare" %></li>
          <% end %>
          <% if @transcription.mood.present? %>
            <li><strong>Mood:</strong>
              <%= {
                "happy" => "😀 Happy", "sad" => "😢 Sad", "anxious" => "😰 Anxious",
                "calm" => "😌 Calm", "excited" => "🤩 Excited", "angry" => "😡 Angry"
              }[@transcription.mood] || @transcription.mood.capitalize %>
            </li>
          <% end %>
          <% if @transcription.tag.present? %>
            <li><strong>Keywords:</strong> <%= @transcription.tag %></li>
          <% end %>
          <% if @transcription.rating.present? %>
            <li><strong>Rating:</strong> <%= @transcription.rating %> / 5</li>
          <% end %>
        </ul>
      </div>
    <% end %>
  </div>
<% else %>
  <p class="text-white text-center mt-5">No analysis found for this dream.</p>
<% end %>

<!-- Bouton d'édition -->
<div class="text-center my-4">
  <%= link_to "Edit dream", edit_dream_path(@dream), class: "gradient-button" %>
</div>
