<% if @analysis.present? %>
  <div class="container px-3" style="white-space: pre-wrap; color: white;">

    <!-- Titre du rêve -->
    <h1 class="mb-4 text-center"><%= @dream.title %></h1>

    <!-- Transcription -->
    <% if @transcription.content.present? %>
      <div class="mb-4">
        <h2>Transcription</h2>
        <p><%= @transcription.content %></p>
      </div>
    <% end %>

    <!-- Résultats du formulaire -->
    <% if @transcription.dream_type.present? || @transcription.mood.present? || @transcription.tag.present? || @transcription.rating.present? %>
      <div class="mb-4">
        <h2>Additional Information</h2>
        <ul>
          <% if @transcription.dream_type.present? %>
            <li>
              <strong>Type of dream:</strong>
              <%= @transcription.dream_type == "dream" ? "🌙 Dream" : "😱 Nightmare" %>
            </li>
          <% end %>

          <% if @transcription.mood.present? %>
            <li>
              <strong>Mood:</strong>
              <%=
                case @transcription.mood
                when "happy" then "😀 Happy"
                when "sad" then "😢 Sad"
                when "anxious" then "😰 Anxious"
                when "calm" then "😌 Calm"
                when "excited" then "🤩 Excited"
                when "angry" then "😡 Angry"
                else @transcription.mood.capitalize
                end
              %>
            </li>
          <% end %>

          <% if @transcription.tag.present? %>
            <li><strong>Keywords:</strong> <%= @transcription.tag %></li>
          <% end %>

          <% if @transcription.rating.present? %>
            <li><strong>Rating:</strong> <%= @transcription.rating %> / 5</li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <!-- Analyse -->
    <div class="mb-4">
      <h2>Analysis</h2>

      <% if @analysis.data.present? %>
        <ul class="nav nav-tabs" id="analysisTabs" role="tablist">
          <% { "symbols" => "🎭 Symbols", "emotions" => "❤️ Emotions", "interpretation" => "🔍 Interpretation", "suggestions" => "🌟 Suggestions" }.each_with_index do |(key, label), index| %>
            <li class="nav-item" role="presentation">
              <button class="nav-link <%= 'active' if index == 0 %>" id="<%= key %>-tab" data-bs-toggle="tab" data-bs-target="#<%= key %>" type="button" role="tab">
                <%= label %>
              </button>
            </li>
          <% end %>
        </ul>

        <div class="tab-content p-3 bg-dark border border-light border-top-0 rounded-bottom" id="analysisTabContent">
          <% { "symbols" => "🎭 Symbols", "emotions" => "❤️ Emotions", "interpretation" => "🔍 Interpretation", "suggestions" => "🌟 Suggestions" }.each_with_index do |(key, label), index| %>
            <div class="tab-pane fade <%= 'show active' if index == 0 %>" id="<%= key %>" role="tabpanel">
              <p><%= @analysis.data[key] %></p>
            </div>
          <% end %>
        </div>
      <% else %>
        <p><%= @analysis.content %></p> <!-- fallback si encore en texte -->
      <% end %>
    </div>
  </div>
<% else %>
  <p class="text-white text-center">No analysis found for this dream.</p>
<% end %>

<!-- Bouton d'édition -->
<div class="text-center my-4">
  <%= link_to "Edit dream", edit_dream_path(@dream), class: "gradient-button" %>
</div>
