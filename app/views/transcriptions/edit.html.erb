<div class="container my-5">
  <h2 class="mb-4 text-center"><%= @dream.title %></h2>

  <p class="text-white mb-4 text-center">
    Help us understand your dream better. All fields are optional.
  </p>

  <%= simple_form_for [@dream, @transcription],
        url: dream_transcription_path(@dream),
        method: :patch,
        html: {
          data: {
            controller: "step-form",
            step_form_current_value: 0
          }
        } do |f| %>

    <!-- Step 0: Dream or Nightmare -->
    <div data-step-form-target="step" data-controller="choice-toggle">
      <h3 class="text-white text-center mb-4">Was it a dream or a nightmare?</h3>
      <div class="d-flex justify-content-center gap-4">
        <label class="option-button" data-choice-toggle-target="button" data-action="click->choice-toggle#toggle">
          <input type="radio" name="transcription[tag]" value="dream">
          🌙 Dream
        </label>
        <label class="option-button" data-choice-toggle-target="button" data-action="click->choice-toggle#toggle">
          <input type="radio" name="transcription[tag]" value="nightmare">
          👻 Nightmare
        </label>
      </div>
    </div>

    <!-- Step 1: Mood -->
    <div class="d-none" data-step-form-target="step" data-controller="emoji-select">
      <h3 class="text-white text-center mb-4">What was your mood?</h3>
      <div class="emoji-select" data-emoji-select-target="emoji">
        <button type="button" class="gradient-button" data-value="happy" data-emoji-select-target="emoji">😄</button>
        <button type="button" class="gradient-button" data-value="sad" data-emoji-select-target="emoji">😢</button>
        <button type="button" class="gradient-button" data-value="angry" data-emoji-select-target="emoji">😡</button>
        <button type="button" class="gradient-button" data-value="anxious" data-emoji-select-target="emoji">😰</button>
        <button type="button" class="gradient-button" data-value="calm" data-emoji-select-target="emoji">😌</button>
        <button type="button" class="gradient-button" data-value="neutral" data-emoji-select-target="emoji">😐</button>
      </div>
      <input type="hidden" name="transcription[mood]">
    </div>

    <!-- Step 2: Tags -->
    <div class="d-none" data-step-form-target="step">
      <h3 class="text-white text-center mb-4">Add tags (optional)</h3>
      <div class="form-group">
        <input type="text" name="transcription[tag]" class="form-control" placeholder="e.g., flying, nightmare, lucid">
      </div>
    </div>

    <!-- Step 3: Rating -->
    <div class="d-none" data-step-form-target="step" data-controller="star-select">
      <h3 class="text-white text-center mb-4">Rate this dream</h3>
      <div class="star-select d-flex justify-content-center gap-2" data-star-select-target="star">
        <% 5.times do |i| %>
          <button type="button"
                  class="star-button"
                  data-value="<%= i + 1 %>"
                  data-action="click->star-select#rate"
                  data-star-select-target="star">
            <i class="fas fa-star fa-2x"></i>
          </button>
        <% end %>
      </div>
      <input type="hidden" name="transcription[rating]" data-star-select-target="input">
    </div>

    <!-- Navigation Buttons -->
    <div class="d-flex justify-content-center gap-3 mt-5">
      <button type="button"
              class="gradient-button"
              data-step-form-target="previous"
              data-action="click->step-form#previous">
        Back
      </button>

      <button type="button"
              class="gradient-button"
              data-step-form-target="next"
              data-action="click->step-form#next">
        Next
      </button>

      <%= f.button :submit,
          "Analyse",
          class: "gradient-button",
          data: { step_form_target: "submit" } %>
    </div>
  <% end %>
</div>

<%= render "shared/bottom_nav" %>
